---
title: "Genex Analysis"
author: "Teresa Gao"
date: "4 May 2020"
output: rmarkdown::github_document
---

# Setup

Load required libraries
```{r Load libraries}

library("dplyr")
library("ggplot2")
library("gridExtra")
library("tidyboot")

```

Go to Session > Set Working Directory > To Source File Location. This ensures that we can find and access the files we need!

The code below imports the experimental data, as extracted by data_extraction.R

```{r Import data (CSVs)}

catch_trials_data <- read.csv("catch_trials_data.csv")
combined_trials_data <- read.csv("combined_trials_data.csv")
subject_info_data <- read.csv("subject_info_data.csv")

```

# Calculations
```{r Compute boostrapped confidence intervals}

CIs <- combined_trials_data %>%
  group_by(item_presentation_condition, n_examples) %>%
  tidyboot_mean(column=slider_response)

```

# Visualization

```{r Rename facet labels}

# This is used on facet_grid plots

n_examples_labels <- c("n_examples: 1", "n_examples: 2", "n_examples:3")
names(n_examples_labels) <- c("1", "2", "3")

trial_num_labels <- c("trial_num: 1", "trial_num: 2", "trial_num: 3")
names(trial_num_labels) <- c("1", "2", "3")

```

Box plot of slider response vs. number of examples

```{r Slider response vs. num. examples}

ggplot(data=combined_trials_data, aes(x=slider_response, y=n_examples, group=n_examples, fill=as.factor(n_examples))) + geom_boxplot() + labs(title="Slider response vs. number of examples", x="Slider response", y="Number of examples") + scale_fill_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="none")

```

Histogram and box plot of average time per slider response for each subject

```{r Average time per slider response}

# Initialize empty data frame for subject average time per trial
subject_average_time <- data.frame()

# Combine every three rows of trials_data, as there are three trials per participant
for(i in 1:nrow(combined_trials_data)) {
  three_row_sum <- 0
  
  # Add next term to sum of three rows
  three_row_sum <- three_row_sum + combined_trials_data[i, "slider_time_in_seconds"]
  three_row_average <- three_row_sum / 3
  
  # If this is the last of the grouping of three rows, add to subject_average_time data frame
  if((i %% 3) == 0) {
    subject_average_time <- rbind(subject_average_time, data.frame(three_row_average, combined_trials_data[i, "n_examples"]))
    three_row_sum <- 0
  }
}

# Rename columns (to make a human-readable histogram)
names(subject_average_time)[1] <- "time_in_seconds"
names(subject_average_time)[2] <- "n_examples"

# Create histogram
histogram <- ggplot(subject_average_time, aes(x=time_in_seconds)) + geom_histogram(fill="cornflowerblue", color="black", bins=24) + labs(title="Average time per slider response", x="Average time (sec)", y="Count")

box_plot <- ggplot(data=subject_average_time, aes(x=time_in_seconds, group=n_examples, fill=as.factor(n_examples))) + geom_boxplot() + labs(title="Average time per slider response", x="Average time (sec)", y="Number of examples") + scale_fill_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="none")

grid.arrange(histogram, box_plot, ncol=2)

```

Box plot of total trial time per participant vs. number of examples displayed

```{r Total trial time vs. num. examples}

ggplot(data=combined_trials_data, aes(x=trial_time_in_seconds, y=n_examples, group=n_examples, fill=as.factor(n_examples))) + geom_boxplot() + labs(title="Total trial time vs. number of examples", x="Total trial time (sec)", y="Number of examples") + scale_fill_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="none")

```

Facet grid of slider response plotted on number of examples vs. item presentation condition

```{r Slider response on num. examples vs. condition}

ggplot(combined_trials_data, aes(x=slider_response, y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..], fill=as.factor(item_presentation_condition))) + geom_histogram(color="black", bins=16) + labs(x="Slider response", y="Fraction of total count") + facet_grid(n_examples ~ item_presentation_condition, labeller=label_both) + scale_fill_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="none")

```

Facet grid of slider response plotted on trial number vs. item presentation condition

```{r slider response on trial number vs. condition}
ggplot(combined_trials_data, aes(x=slider_response, y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..], fill=as.factor(item_presentation_condition))) + geom_histogram(color="black", bins=16) + labs(x="Slider response", y="Fraction of total count") + facet_grid(trial_num ~ item_presentation_condition, labeller=label_both) + scale_fill_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="none")
```

Facet grid of slider response plotted on number of examples vs. item presentation condition and item property

```{r Slider response on num examples vs. condition and property}

ggplot(combined_trials_data, aes(x=slider_response, y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..], fill=as.factor(item_presentation_condition))) + geom_histogram(color="black", bins=6) + labs(x="Slider response", y="Fraction of total count") + facet_grid(n_examples ~ item_presentation_condition+property, labeller=labeller(n_examples=n_examples_labels)) + scale_fill_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="none")

```

Facet grid of slider resopnse plotted on speaker vs. item presentation condition

```{r Slider response on speaker vs. condition}

ggplot(combined_trials_data, aes(x=slider_response, y=(..count..)/tapply(..count..,..PANEL..,sum)[..PANEL..], fill=as.factor(item_presentation_condition))) + geom_histogram(color="black", bins=16) + labs(x="Slider response", y="Fraction of total count") + facet_grid(speaker ~ item_presentation_condition, labeller=label_both) + scale_fill_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="none")

```

Line range of slider response means and confidence intervals grouped by item presentation condition

```{r Slider response means and CIs vs. condition}

ggplot() + geom_linerange(data=CIs, mapping=aes(x=item_presentation_condition, ymin=ci_lower, ymax=ci_upper, color=as.factor(item_presentation_condition)), size=1) + geom_point(data=CIs, mapping=aes(x=item_presentation_condition, y=mean), alpha=0.5, size=2) + scale_color_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + labs(y="Slider response", x="Item presentation condition") + theme(legend.position="none")

```

Line range of slider response means and confidence intervals grouped by number of examples

```{r Slider response means and CIs vs. num examples}

ggplot() + geom_linerange(data=CIs, mapping=aes(x=n_examples, ymin=ci_lower, ymax=ci_upper, color=as.factor(item_presentation_condition)), size=1) + geom_point(data=CIs, mapping=aes(x=n_examples, y=mean), alpha=0.5, size=2) + labs(y="Slider response", x="Number of examples", color="Item presentation condition") + scale_color_manual(values=c("indianred1", "lightgoldenrod1", "darkolivegreen2", "cornflowerblue")) + theme(legend.position="bottom")

```